{% extends "buch/base.html" %}

{% block title %}Neuer Eintrag{% endblock %}

{% block content %}
<h2>Neuer Schichtbucheintrag</h2>

{% if form.errors %}
    <div class="errors">
        Bitte die markierten Felder überprüfen.
    </div>
{% endif %}

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="field">
        {{ form.date.label_tag }}
        {{ form.date }}
        {{ form.date.errors }}
    </div>
    <div class="field">
        {{ form.shift.label_tag }}
        {{ form.shift }}
        {{ form.shift.errors }}
    </div>
    <div class="field">
        {{ form.machine.label_tag }}
        {{ form.machine }}
        {{ form.machine.errors }}
    </div>
    <div class="field">
        {{ form.category.label_tag }}
        {{ form.category }}
        {{ form.category.errors }}
    </div>
    <div class="field">
        {{ form.title.label_tag }}
        {{ form.title }}
        {{ form.title.errors }}
    </div>
    <div class="field">
        {{ form.description.label_tag }}
        {{ form.description }}
        {{ form.description.errors }}
    </div>
    <div class="field">
        {{ form.duration_minutes.label_tag }}
        {{ form.duration_minutes }}
        {{ form.duration_minutes.errors }}
    </div>
    <div class="field">
        {{ form.priority.label_tag }}
        {{ form.priority }}
        {{ form.priority.errors }}
    </div>
    <div class="field">
        {{ form.status.label_tag }}
        {{ form.status }}
        {{ form.status.errors }}
    </div>

    <hr>
    <h3>Ersatzteile</h3>

    <div class="field">
        {{ form.used_spare_parts.label_tag }}
        {{ form.used_spare_parts }}
        {{ form.used_spare_parts.errors }}
    </div>

    <div id="spare-part-details" style="margin-left: 10px;">
        <div class="field">
            {{ form.spare_part_description.label_tag }}
            {{ form.spare_part_description }}
            {{ form.spare_part_description.errors }}
        </div>
        <div class="field">
            {{ form.spare_part_sap_number.label_tag }}
            {{ form.spare_part_sap_number }}
            {{ form.spare_part_sap_number.errors }}
        </div>
        <div class="field">
            {{ form.spare_part_quantity_used.label_tag }}
            {{ form.spare_part_quantity_used }}
            {{ form.spare_part_quantity_used.errors }}
        </div>
        <div class="field">
            {{ form.spare_part_quantity_remaining.label_tag }}
            {{ form.spare_part_quantity_remaining }}
            {{ form.spare_part_quantity_remaining.errors }}
        </div>
    </div>

    <hr>

    <div class="field">
        {{ form.image.label_tag }}
        {{ form.image }}
        {% if form.image.help_text %}
            <small>{{ form.image.help_text }}</small>
        {% endif %}
        {{ form.image.errors }}
    </div>

    <button type="submit" class="btn btn-primary">Speichern</button>
</form>

<script>
    function toggleSparePartDetails() {
        const checkbox = document.getElementById("id_used_spare_parts");
        const details = document.getElementById("spare-part-details");
        if (!checkbox || !details) return;
        details.style.display = checkbox.checked ? "block" : "none";
    }

    document.addEventListener("DOMContentLoaded", function () {
        const checkbox = document.getElementById("id_used_spare_parts");
        if (checkbox) {
            checkbox.addEventListener("change", toggleSparePartDetails);
            toggleSparePartDetails();  // initialer Zustand
        }
    });
</script>
{% endblock %}