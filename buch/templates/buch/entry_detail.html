{% extends "buch/base.html" %}

{% block title %}Eintrag Details{% endblock %}

{% block content %}
<h2>Schichtbucheintrag</h2>

<table>
    <tr><th>Datum</th><td>{{ entry.date }}</td></tr>
    <tr><th>Schicht</th><td>{{ entry.get_shift_display }}</td></tr>
    <tr><th>Maschine</th><td>{{ entry.machine }}</td></tr>
    <tr><th>Kategorie</th><td>{{ entry.get_category_display }}</td></tr>
    <tr>
        <th>Status</th>
        <td class="status-{{ entry.status }}">
        {{ entry.get_status_display }}
        </td>
    </tr>
    <tr><th>Dauer (min)</th><td>{{ entry.duration_minutes }}</td></tr>
    <tr><th>PrioritÃ¤t</th><td>{{ entry.priority }}</td></tr>
    <tr><th>Mitarbeiter</th><td>{{ entry.user.username }}</td></tr>
</table>

<h3>Titel</h3>
<p><strong>{{ entry.title }}</strong></p>

<h3>Beschreibung</h3>
<p>{{ entry.description|linebreaks }}</p>

{% if entry.used_spare_parts and can_view_spares %}
    <h3>Ersatzteile</h3>
    <table>
        <tr>
            <th>Beschreibung</th>
            <td>{{ entry.spare_part_description }}</td>
        </tr>
        <tr>
            <th>SAP-Nummer</th>
            <td>{{ entry.spare_part_sap_number }}</td>
        </tr>
        <tr>
            <th>Entnommene Anzahl</th>
            <td>{{ entry.spare_part_quantity_used }}</td>
        </tr>
        <tr>
            <th>Bestand nach Entnahme</th>
            <td>{{ entry.spare_part_quantity_remaining }}</td>
        </tr>
    </table>

{% elif entry.used_spare_parts %}
    <!-- Es wurden Ersatzteile genutzt, aber Benutzer ist nicht berechtigt -->
    <p><em>Ersatzteile wurden verwendet. Details sind nur fÃ¼r Meister/Admin oder den Ersteller sichtbar.</em></p>
{% endif %}

{% if entry.images.all %}
    <h3>Bilder</h3>
    {% for img in entry.images.all %}
        <div style="margin-bottom:15px;">
            <img src="{{ img.image.url }}" style="max-width:100%; max-height:500px;">
            {% if img.comment %}
                <p><em>{{ img.comment }}</em></p>
            {% endif %}
        </div>
    {% endfor %}
{% else %}
    <p><em>Keine Bilder vorhanden.</em></p>
{% endif %}

{# ğŸ”¥ NEU: Videos #}
{% if entry.videos.all %}
    <h3>Videos</h3>
    {% for vid in entry.videos.all %}
        <div style="margin-bottom:15px;">
            <video controls style="max-width:100%; max-height:500px;">
                <source src="{{ vid.video.url }}">
                Dein Browser unterstÃ¼tzt das Video-Tag nicht.
            </video>
            {% if vid.comment %}
                <p><em>{{ vid.comment }}</em></p>
            {% endif %}
        </div>
    {% endfor %}
{% else %}
    <p><em>Keine Videos vorhanden.</em></p>
{% endif %}

<form action="{% url 'toggle_like' entry.id %}" method="post" style="margin-top:15px;">
    {% csrf_token %}

    <button type="submit" class="btn">
        ğŸ‘ Like ({{ entry.likes.count }})
    </button>

</form>

<p>
    <a href="{% url 'home' %}" class="btn">â† ZurÃ¼ck</a>
</p>

{% endblock %}